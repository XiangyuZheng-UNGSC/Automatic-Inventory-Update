name: Auto-Update Asset Inventory

# This tells GitHub to run the script ONLY when these specific files are pushed/updated
on:
  push:
    paths:
      - 'Asset_Inventory.csv'
      - '*vSphere World.csv'
      - '*VMs all discovered.csv'
      - '*latest_agents*.csv'
      - 'process_inventory.py'
permissions:
  contents: write
jobs:
  run-inventory-script:
    runs-on: ubuntu-latest # Spins up a temporary Linux server

    steps:
      # 1. Download your repository files onto the server
      - name: Checkout Code
        uses: actions/checkout@v3

      # 2. Install Python
      - name: Set up Python 3.10
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      # 3. Install Pandas and Numpy
      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pandas numpy

      # 4. Run the data processing script
      - name: Execute Python Script
        run: python process_inventory.py

# 5. Automatically commit the newly generated files back to your repository
      - name: Commit and Push Updated Files
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action Bot"
          git add Asset_Inventory_Updated.csv Update_Log.md 
          git commit -m "Automated update of Asset Inventory and Log" || echo "No changes to commit"
          git push
